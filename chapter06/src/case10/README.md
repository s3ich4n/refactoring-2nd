# 6.10 여러 함수를 변환 함수로 묶기

_Combine Functions into Transform_

## 개요

Before

```python
def base(a_reading): ...
def taxable_charge(a_reading): ...
```

After

```python
def enrich_reading(reading):
    a_reading = reading.copy()
    a_reading.base_charge = base(a_reading)
    a_reading.taxable_charge = taxable_charge(a_reading)
    
    return a_reading
```

## 배경

소프트웨어가 데이터를 받고 정보를 도출할 때 이는 여러 곳에서 쓰일 수 있다. 그런데 이 도출작업은 하나로 모아두는 것이 좋다.
모아두면 검색 및 갱신을 일관되게 처리할 수 있고, 로직중복을 막을 수 있다.

이를 위한 변환 함수(transform function)을 쓴다. 변환함수는 원본 데이터를 입력받은 후 필요정보를 도출하고 각각을 출력 데이터의 필드에 넣어 반환한다.
도출 과정은 오직 이 함수만 보면 된다.

이와 유사하게 여러 함수를 클래스로 묶어도(6.9절) 된다. 하지만 둘 사이에는 중요한 차이가 있다:
- 클래스로 묶는 경우: 원본 데이터가 코드 안에서 갱신될 때
- 변환 함수로 묶는 경우: 가공한 데이터를 새 레코드에 저장할 때 (원본 데이터의 일관성을 위함)

이렇게 묶는 주요 이유는 중복을 피해서다. 이 로직을 함수로 추출(6.1절)해도 동일한 효과를 얻을 수 있지만, 변환함수(클래스)로 묶으면 이런 함수를 쉽게 찾아 쓸 수 있다.

## 절차

1. 변환할 레코드를 입력받아서 값을 그대로 반환하는 변환 함수를 만든다 <br />
→ deep copy로 처리해야 함. 변환 함수가 원본 레코드를 바꾸지 않는지도 테스트 해야함 (하면 좋다인데, 가능하면 하는 걸로)
2. 묶을 함수 중 함수 하나를 골라서 본문 코드를 변환 함수로 옮기고, 처리 결과를 레코드에 새 필드로 기록한다. 그 후 클라이언트 코드가 이 필드를 쓰도록 수정한다 <br />
→ 너무 복잡하면 함수 추출하기(6.1절)부터 한다
3. 테스트한다
4. 나머지 관련 함수도 위 과정에 맞게 처리한다.

## 예시



> ![TIP]
> 마틴 파울러는 함수의 성향에 따라 이런 이름을 즐겨 짓는다:
> 
> - `enrich` 접두사: 본질은 같고 부가정보만 덧붙이는 변환함수
> - `transform` 접두사: 형태가 변하는 변환함수
