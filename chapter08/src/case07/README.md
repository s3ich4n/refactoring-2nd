# 8.7 반복문 쪼개기

_Split Loop_

## 개요

Before

```python
average_age = 0
total_salary = 0
for p in people:
    average_age += p.age
    total_salary += p.salary
average_age = average_age / len(people)
```

After

```python
total_salary = 0
for p in people:
    total_salary += p.salary

average_age = 0
for p in people:
    average_age += p.age
average_age = average_age / len(people)
```

## 배경

반복문에서 두 가지 일을 수행하는 케이스를 자주 보게된다. 이러면 반복문을 ***수정할 때*** 가 문제다. 두 일을 잘 이해하고 나눠야 하니까.
그렇게 때문에 하나로 나누는 것이 더 효율적이다.

반복문을 분리하면 쓰기도 쉬워진다. 하나의 값만 계산하는거면 그 값만 바로 리턴할 수 있다. 여러 일을 수행하는 반복문은 구조체를 반환하거나 지역변수를 써야한다.
반복문 쪼개기는 서로 다른 일들이 한 함수에서 이루어지고 있다는 신호일 수 있고, 반복문 쪼개기와 함수 추출하기(6.1절)은 같이 쓰이는 경우가 잦다.

반복문을 두번쓰는게 최적화하고는 거리가 있다. 리팩터링과 최적화는 다르다. 1장때 얘기했지만, 최적화는 코드가 깔끔하면 훨씬 수행하기 쉽다.
반복문이 병목이라면 그 때 하나로 합치는 건 쉽다. 요즘은 긴 리스트를 반복해도 병목으로 이러지는 경우가 드물다.
차라리 반복문을 쪼개는 편이 더 강력한 최적화를 적용할 수 있는 방안 모색에 도움된다.

반복문 같은거로 병목이 이루어지는 일은 매우 드물다. 차라리 나누는 게 더 강력한 최적화를 하는 과정이다. 

## 절차

`<br />`, `→` 복사해서 쓰기

1. 반복문을 복제해서 두 개로 만든다
2. 반복문이 중복되어 생기는 부수효과를 파악해서 제거한다
3. 테스트한다
4. 완료했으면 각 반복문을 함수로 추출(6.1절)할지 생각해본다

## 예시

