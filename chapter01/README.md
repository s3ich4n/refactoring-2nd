# 1장

예시를 토대로 살펴봅시다.

## 1.1. 시작해봅시다

코드 따라치는데 대체로 비슷하게 했다.

요구사항

- 공연요청, 관객규모를 기초로 비용을 책정하는 프로그램 작성
- 비극, 희극만 궁연함
- 공연료와 포인트(`volume_credit`)을 지급해서, 다음 번 의뢰시 공연료 할인도 가능함

## 1.2. 예시 프로그램을 본 소감

쉽지않다 ㅋㅋ

그래도 어쨌든 작동한다. 그런데 설계가 나쁘면 고치기가 어렵다. 손대기가 어려우면 버그가 날 가능성이 높아진다.

코드 수정이 필요하면? 작동방식을 쉽게 파악할 수 있도록 코드를 여러 함수와 프로그램 요소로 재구성한다.
구조부터 다시 잡고 기능을 수정하는 편이 좋다.

> 프로그램이 새 기능을 추가하기 편한 구조가 아니면, 기능을 잡기 쉬운 구조로 바꾸자.

### 추가 요구사항 (1)

"청구내역을 HTML로 출력해야한다" 면...

현재 `statement()` 을 그대로 쓰면 함수가 너무 복잡해진다.

대안 1: 함수 복붙 후 거기서 HTML을 출력(`htmlStatement()`)

한번 짜고 말 코드면 그래도 되지만, 오래 쓸 프로그램이면 골치아파진다.

### 추가 요구사항 (2)

배우가 연기하고 싶은 장르가 많아진다면, 공연료 및 적립 포인트 계산방식도 바뀐다. "거의 확실히 바뀐다".

대안 2: 또 함수 복붙 후 로직 수정

그럼 대안 1에서 만든 `htmlStatement()` 에도 반영해야한다.

정책이 복잡해지면 수정할 부분 찾기도 힘들고 실수도 필연적이다.

### 그래서...

리팩터링은 변경을 위해 필요하다.

## 1.3. 리팩터링의 첫 단계

1. 테스트코드를 마련한다.
    - 청구서 몇개를 준비하고
    - `statement()` 의 정답 문자열과 비교한다.
    - 단축키 딸깍으로 테스트를 바로 볼 수 있게 세팅한다.

> 리팩터링 하기 전에 테스트부터 마련한다. 테스트는 자가진단하도록 만든다

## 1.4. `statement()` 함수 쪼개기

전체 동작을 각각의 부분으로 나누는 지점부터 물색 -- switch case[^1]

이런 switch문은 코드 스스로가 할 수 있도록 함수로 추출해야한다[^2]. 이름은 `amountFor(aPerformance)` 정도로.

[^1]: 파이썬에서는 pattern match 구문
[^2]: "6.1절, 함수 추출하기"