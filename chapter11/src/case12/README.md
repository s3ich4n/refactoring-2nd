# 11.12 오류 코드를 예외로 바꾸기

_Replace Error Code with Exception_

## 개요

Before

```python
if data:
    return ShippingRules(data)
else:
    return -23
```

After

```python
if data:
    return ShippingRules(data)
else:
    raise OrderProcessingError(-23)
```

## 배경

프로그래밍에 오류코드(_error code_)를 쓰는 것은 오래전 매우 효과적인 방법이었다.
그래서 콜스택으로 도로 돌려보내서, 에러가 나면 처리하는 방식이었다.

예외는 프로그래밍 언어에서 제공하는 독립적인 오류 처리 메커니즘이다.
오류가 발견되면 예외를 던지고, 적절한 예외 핸들러가 보일 때 까지 콜스택을 타고 계속 전파된다.
핸들러를 못찾으면 아주 기본적인 동작이 리턴된다.
예외는 독자적 흐름이 따로 있기때문에 프로그램의 나머지는 그 복잡한 코드를 안읽어도 되게 해준다.

예외는 정확하게 쓸 때 진가를 발휘한다. 예외는 정확히 예상밖의 동작일 때 쓰여야 한다.
다시말해 프로그램의 정상 동작 범주에 들지 않는 오류를 나타낼 때만 쓰여야 한다.
마틴 파울러는 이런 경험적 법칙을 소개한다.
예외를 던지는 코드를 프로그램 종료 코드로 바꿔도 프로그램이 정상동작할지 따져보라고 제안한다. 이 때 정상동작 하지 않으면 예외는 어울리지 않는다. 
그런 경우 예외 대신 오류를 검출하여 프로그램을 정상흐름으로 되돌리게끔 처리하기를 제안한다.

## 절차

1. 콜스택 상위에 해당 예외를 처리할 예외 핸들러를 작성한다. <br />
→ 이 핸들러는 처음엔 모든 예외를 다시 던지게 해둔다. <br />
→ 적절한 처리를 해주는 핸들러가 이미 있다면 지금의 콜스택도 처리할 수 있도록 확장한다
2. 테스트한다
3. (자신이 사용중인 프로그래밍 언어에 맞게) 해당 오류 코드를 대체할 예외와 그 밖의 예외를 구분할 식별방법을 찾는다[^1]. <br />
4. 정적 검사를 수행한다
5. `catch` 구문을 수정해서 직접 처리할 수 있는 예외는 처리하고, 아니면 다시 던진다
6. 테스트한다
7. 오류 코드를 반환하는 곳 모두에서 예외를 던지도록 수정한다. 하나씩 수정할 때마다 테스트한다
8. 모두 수정했다면 그 오류코드를 콜스택 위로 전달하는 코드를 모두 제거한다. 하나씩 수정할 때마다 테스트한다 <br />
→ 오류 코드를 검사하는 부분을 함정(_trap_)으로 바꾸고 함정에 걸리진 않았나 테스트하고 제거하는 전략을 권한다. 함정에 걸려들면 아직 코드가 남아있다는 것이다. 함정에 더이상 빠져들지 않으면 죽은코드를 제거(8.9절)한다

## 예시

[^1]: 대부분의 언어는 서브클래스를 사용하는 것으로 해결된다