# 11.5 매개변수를 질의 함수로 바꾸기

_Replace Parameter with Query_

## 개요

Before

```python
available_vacation(an_employee, an_employee.grade)

def available_vacation(an_employee, grade):
    """연휴 계산"""
    ...
```

After

```python
available_vacation(an_employee)

def available_vacation(an_employee):
    """연휴 계산"""
    grade = an_employee.grade
    ...
```

## 배경

매개변수의 목록은 함수의 변동요인을 모아놓은 곳이다. 즉 함수의 동작에 변화를 줄 수 있는 일차적인 수단이다.
이 목록도 중복은 최대한 피해야하고, 짧을 수록 읽는 사람이 이해하기 쉽다.

함수가 스스로 ***쉽게*** 결정할 수 있는 걸 굳이 매개변수로 주지 않는 게 좋다. 이런 함수를 호출할 때 매개변수 값은 호출자가 정하니까.

이 리팩터링은 한계점이 있다. 언급되는 종류의 매개변수를 빼면 값을 결정하는 책임 주체가 달라진다.
매개변수가 있다면 호출자가 값을 결정한다. 매개변수가 없다면 함수 함수가 결정한다.
마틴 파울러는 습관적으로 호출하는 쪽을 간소하게 하길 제안한다. i.e., 함수가 책임지게 한단 뜻이다.
물론 함수가 그 역할을 수행하기에 적합할 때 유효하다.

이 리팩터링을 하면 안되는 때도 있다. 매개변수를 제거했을 때, 함수에 의존성이 생길 때다.
다시말해 함수는 몰라도 되었을 프로그램 요소에 접근하는 상황이 생길 때다. 새 의존성이 생기거나 제거하고 싶은 기존 의존성을 강화하는 경우라 할 수 있다.
이런 상황은 주로 함수 본문이나 문제의 외부 함수를 호출해야 하거나 나중에 함수 밖으로 빼길 원하는 수용객체 (_receiver object_)에 담긴 데이터를 사용해야할 때 일어난다.

제거하려는 매개변수의 값을 다른 매개변수에 질의해서 얻을 수 있으면 상관없다. 굳이 얻을 수 있는 걸 매개변수로 또 줄 이유가 없다.

주의사항이 하나 더 있다. 대상 함수가 참조 투명(_referential transparency_)해야한다는 것이다.
이런 함수는 동작을 예측하고 테스트하기도 쉽다. 매개변수를 없애는 대신 가변 전역변수를 쓰는 식으로 하면 안 된다.

> ![TIP]
> 
> 참조 투명은 '함수에 똑같은 값을 건네 호출하면 항상 똑같이 동작한다' 를 의미한다.


## 절차

1. 필요하면 대상 매개변수의 값을 계산하는 코드를 별도 함수로 추출(6.1절)해둔다.
2. 함수 본문에서 대상 매개변수를 참조하는 걸 모두 찾는다. 이후 그 매개변수의 값을 만들어주는 표현식을 대신 참조하게 한다. 하나 바꾸면 테스트한다.
3. 함수 선언 바꾸기(6.5절)로 대상 매개변수를 없앤다.

## 예시

