# 11.9 함수를 명령으로 바꾸기

_Replace Function with Command_

## 개요

Before

```python
def score(candidate, medical_exam, scoring_guide):
    result = 0
    health_level = 0
    ...
```

After

```python
class Scorer:
    def __init__(self, candidate, medical_exam, scoring_guide):
        self._candidate = candidate
        self._medical_exam = medical_exam
        self._scoring_guide = scoring_guide
        self._result = 0
        self._health_level = 0
        
    def execute(self):
        ...
```

> ![TIP]
> 반대 리팩터링: 명령을 함수로 바꾸기 (11.10절)

## 배경

함수는 프로그래밍의 가장 기본적인 빌딩블록이다. 함수를 그 함수만을 위한 객체 안으로 캡슐화하면 더 유용해지는 상황이 있다.
이런 객체를 가리켜 '명령 객체' 혹은 단순히 '명령(_command_)'이라 한다.
명령객체 대부분은 메소드 하나로 구성되며, 이 메소드를 요청해 실행하는 것이 이 객체의 목적이다.

명령(_command_)은 평범한 함수 메커니즘 보다 훨씬 유연하게 함수를 제어하고 표현할 수 있다.
되돌리기(_undo_)같은 보조연산을 제공할 수도 있고, 수명 주기를 더 정밀하게 제어하는 데 필요한 매개변수를 만들어주는 메소드도 제공할 수 있다.
상속과 훅(_hook_)을 통해 사용자 맞춤형으로 만들 수도 있다. [^1]

명령의 이점은 코드의 복잡성이다. 어느정도냐면 마틴 파울러의 언급을 보았을 때, 일급함수냐, 명령이냐 라고하면 95%는 일급함수를 택하겠다고 말한 것이다.
명령은 그 복잡함이 진짜 필요할 때 유용하다는 것을 시사하는 것이다.

> ![NOTE]
> 
> 여기에서의 '명령'은 요청을 캡슐화한 것으로, `COMMAND` 패턴과 같다.
> 이 책에서 '요청을 캡슐화'하는 개념의 '명령'을 이야기할 때는 '명령 객체'라고 언급 후 '명령'으로 줄여말한다.
> 
> 명령-질의 분리 원칙[^2] 에서의 명령은 객체의 겉보기 상태를 변경하는 메소드를 말한다.
> 이 책에서 '객체의 겉보기 상태 변경'하는 개념의 '명령'은 '변경 함수'라고 언급되어 말한다.

## 절차

1. 대상 함수의 기능을 옮길 빈 클래스를 만든다. 클래스 이름은 함수 이름에 기초하여 짓는다
2. 방금 생성한 빈 클래스로 함수를 옮긴다(8.1절) <br />
→ 리팩터링이 끝날 때 까지는 원래 함수를 전달함수 역할로 쓴다 <br />
→ 명령 관련 이름은 쓰는 언어의 명명규칙을 따른다. 달리 규칙이 없다면 "execute", "call" 정도가 좋겠다
3. 함수의 인수들 각각은 명령의 필드로 만들어 생성자를 통해 설정할지 고민한다.

## 예시

[^1]: 일급함수를 지원하지 않으면 명령으로 일급함수를 흉내낼 수도 있고, 중첩함수를 지원하지 않는 언어에서도 메소드와 필드로 잘게 쪼갤 수 있으며, 테스트와 디버깅에 활용할 수 있다.
[^2]: https://martinfowler.com/bliki/CommandQuerySeparation.html